(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{246:function(t,s,e){"use strict";e.r(s);var a=e(0),n=Object(a.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"content"},[e("h1",{attrs:{id:"thumbnailer"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#thumbnailer","aria-hidden":"true"}},[t._v("#")]),t._v(" Thumbnailer")]),t._v(" "),e("p",[t._v("The thumbnailer is a feature of Directus that dynamically returns thumbnails upon request. To avoid a potential DDoS or other malicious activity, all thumbnail versions are whitelisted based on the configuration.")]),t._v(" "),e("h2",{attrs:{id:"url-syntax"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#url-syntax","aria-hidden":"true"}},[t._v("#")]),t._v(" URL Syntax")]),t._v(" "),e("div",{staticClass:"language-url extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("https://directus.example.com/thumbnail/<project>/<width>/<height>/<action>/<quality>/<filename>\n")])])]),e("h2",{attrs:{id:"request-flow"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#request-flow","aria-hidden":"true"}},[t._v("#")]),t._v(" Request Flow")]),t._v(" "),e("ol",[e("li",[t._v("A user requests a thumbnail of a specific Directus file using the URL syntax above")]),t._v(" "),e("li",[t._v("The request is routed through an .htaccess file (or nginx equivalent) to the thumbnailer that checks if the thumbnail already exists")]),t._v(" "),e("li",[t._v("If it already exists:\n"),e("ol",[e("li",[e("strong",[t._v("The thumbnail is returned")])])])]),t._v(" "),e("li",[t._v("If it does "),e("em",[t._v("NOT")]),t._v(" exist\n"),e("ol",[e("li",[t._v("The requested size is validated against the whitelist")]),t._v(" "),e("li",[t._v("The thumbnail is generated and saved in the filesystem")]),t._v(" "),e("li",[e("strong",[t._v("The thumbnail is returned")])])])])]),t._v(" "),e("p",[t._v("As you can see, when requesting a thumbnail the end result is the same, all of the heavy-lifting happens automatically behind the scenes.")]),t._v(" "),e("h2",{attrs:{id:"configuration"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#configuration","aria-hidden":"true"}},[t._v("#")]),t._v(" Configuration")]),t._v(" "),e("p",[t._v("The whitelist is managed within the project's "),e("em",[t._v("Global Settings")]),t._v(" and are stored in the "),e("code",[t._v("directus_settings")]),t._v(" collection using the "),e("code",[t._v("thumbnail")]),t._v(" scope. Below are the configurable options:")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("dimensions")]),t._v(" – An array of allowed sizes with the format: "),e("code",[t._v("[width]x[height]")]),t._v(" in pixels (eg: "),e("code",[t._v("100x100")]),t._v(")")]),t._v(" "),e("li",[e("code",[t._v("qualityTags")]),t._v(" – An array of key-value-pairs where the key is the name used in the url and the value is the JPG compression (0-100) (eg: "),e("code",[t._v("'better' => 75")]),t._v(")")]),t._v(" "),e("li",[e("code",[t._v("actions")]),t._v(" – This is an array of actions, each with nested options defining specifically how the thumbnail will be created. The two predefined options are:\n"),e("ul",[e("li",[e("code",[t._v("contain")]),t._v(' – Maintains the original aspect ratio, scaling the image to fit entirely within the dimension bounds. Any "negative space" can be filled with the '),e("code",[t._v("canvasBackground")]),t._v(" color.")]),t._v(" "),e("li",[e("code",[t._v("crop")]),t._v(" –  Scales the image to completely fill the entire dimension bounds; the aspect ratio will always match the dimensions")])])])]),t._v(" "),e("div",{staticClass:"tip custom-block"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[t._v("Make sure the "),e("code",[t._v("root")]),t._v(", "),e("code",[t._v("root_url")]),t._v(", and "),e("code",[t._v("thumb_root")]),t._v(" keys within the "),e("code",[t._v("filesystem")]),t._v(" section of your project config file are set properly. Otherwise you may receive 404s instead of images.")])]),t._v(" "),e("h3",{attrs:{id:"example-configuration"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#example-configuration","aria-hidden":"true"}},[t._v("#")]),t._v(" Example Configuration")]),t._v(" "),e("div",{staticClass:"language-php extra-class"},[e("pre",{pre:!0,attrs:{class:"language-php"}},[e("code",[e("span",{attrs:{class:"token comment"}},[t._v("// dimensions")]),t._v("\n"),e("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),e("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'100x100'")]),e("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'200x200'")]),e("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'100x200'")]),e("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),e("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),e("span",{attrs:{class:"token comment"}},[t._v("// qualityTags")]),t._v("\n"),e("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),e("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'poor'")]),t._v(" "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),e("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{attrs:{class:"token number"}},[t._v("25")]),e("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'good'")]),t._v(" "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),e("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{attrs:{class:"token number"}},[t._v("50")]),e("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'better'")]),t._v(" "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),e("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{attrs:{class:"token number"}},[t._v("75")]),e("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'best'")]),t._v(" "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),e("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{attrs:{class:"token number"}},[t._v("100")]),e("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),e("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),e("span",{attrs:{class:"token comment"}},[t._v("// actions")]),t._v("\n"),e("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'contain'")]),t._v(" "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),e("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),e("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'options'")]),t._v(" "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),e("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),e("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'resizeCanvas'")]),t._v(" "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),e("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{attrs:{class:"token boolean"}},[t._v("false")]),e("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{attrs:{class:"token comment"}},[t._v("// http://image.intervention.io/api/resizeCanvas")]),t._v("\n    "),e("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'position'")]),t._v(" "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),e("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'center'")]),e("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'resizeRelative'")]),t._v(" "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),e("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{attrs:{class:"token boolean"}},[t._v("false")]),e("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'canvasBackground'")]),t._v(" "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),e("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'ccc'")]),e("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{attrs:{class:"token comment"}},[t._v("// http://image.intervention.io/getting_started/formats")]),t._v("\n   "),e("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n "),e("span",{attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),e("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'crop'")]),t._v(" "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),e("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),e("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'options'")]),t._v(" "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),e("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),e("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'position'")]),t._v(" "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),e("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'center'")]),e("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{attrs:{class:"token comment"}},[t._v("// http://image.intervention.io/api/fit")]),t._v("\n   "),e("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),e("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),e("h2",{attrs:{id:"examples"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#examples","aria-hidden":"true"}},[t._v("#")]),t._v(" Examples")]),t._v(" "),e("p",[t._v("Based on the configuration above, below are a few examples that show the output of the Thumbnailer.")]),t._v(" "),e("p",[e("a",{attrs:{href:"/img/thumbnailer/original.jpg"}},[t._v("Original File Used Below")]),e("br"),e("em",[t._v("602KB • 1800x1200")])]),t._v(" "),e("h3",{attrs:{id:"crop-better-200x200"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#crop-better-200x200","aria-hidden":"true"}},[t._v("#")]),t._v(" Crop Better 200x200")]),t._v(" "),e("p",[t._v("Using the URL "),e("code",[t._v("http://directus.example.com/thumbnail/_/200/200/crop/better/file-name.jpg")]),t._v(" a thumbnail would be generated on the server's filesystem at "),e("code",[t._v("thumbnail/_/200/200/crop/better/file-name.jpg")]),t._v('. We crop the image from the previous landscape aspect-ratio to become the a square. The "better" quality has a few compression artifacts, but keeps the filesize down significantly. Below we compare all four possible qualities for a 200x200 crop to see the balance between compression and filesize:')]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("Poor")]),t._v(" "),e("th",[t._v("Good")]),t._v(" "),e("th",[t._v("Better")]),t._v(" "),e("th",[t._v("Best")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[e("img",{attrs:{src:"/img/thumbnailer/200-200-crop-poor.jpg",alt:"Poor"}}),e("br"),e("em",[t._v("4KB")])]),t._v(" "),e("td",[e("img",{attrs:{src:"/img/thumbnailer/200-200-crop-good.jpg",alt:"Good"}}),e("br"),e("em",[t._v("6KB")])]),t._v(" "),e("td",[e("img",{attrs:{src:"/img/thumbnailer/200-200-crop-better.jpg",alt:"Better"}}),e("br"),e("em",[t._v("8KB")])]),t._v(" "),e("td",[e("img",{attrs:{src:"/img/thumbnailer/200-200-crop-best.jpg",alt:"Best"}}),e("br"),e("em",[t._v("38KB")])])])])]),t._v(" "),e("div",{staticClass:"tip custom-block"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[t._v("Images are never stretched or distorted even when changing the aspect ratio.")])]),t._v(" "),e("h3",{attrs:{id:"contain-better-200x200"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#contain-better-200x200","aria-hidden":"true"}},[t._v("#")]),t._v(" Contain Better 200x200")]),t._v(" "),e("p",[t._v("Now let's use the first example again, but this time with "),e("code",[t._v("contain")]),t._v(" action. Now our URL is "),e("code",[t._v("http://directus.example.com/thumbnail/_/200/200/contain/better/file-name.jpg")]),t._v(", which saves the thumbnail to the server's filesystem at "),e("code",[t._v("thumbnail/_/200/200/contain/better/file-name.jpg")]),t._v(". As you can see ferom the example below, this new thumbnail has not been cropped at all... it has simply been shrunk to fit within the 200x200 bounds.")]),t._v(" "),e("p",[e("img",{attrs:{src:"/img/thumbnailer/200-200-contain-better.jpg",alt:"Contain"}}),e("br"),e("em",[t._v("27KB • 200x133")])]),t._v(" "),e("div",{staticClass:"tip custom-block"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[t._v("You can also use the contain action with the "),e("code",[t._v("resizeCanvas")]),t._v(' enabled. This would result in the same thumbnail as above but with "letterboxing" since the requested dimensions are forced and any negative space is filled with the '),e("code",[t._v("canvasBackground")]),t._v(" color.")])])])}],!1,null,null,null);n.options.__file="thumbnailer.md";s.default=n.exports}}]);